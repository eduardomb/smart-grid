!function(o){"use strict";o.fn.grid=function(t){function i(o){return o+"px"}function n(o){for(var t,i,n=o.length;0!==n;)i=Math.floor(Math.random()*n),n-=1,t=o[n],o[n]=o[i],o[i]=t;return o}function s(o,t){if(t[S]+o[S]-1>=L.cols)return!1;for(var i=t[w];i<t[w]+o[w];i++)for(var n=t[S];n<t[S]+o[S];n++)if(void 0!==C[i]&&C[i][n]>=0)return!1;return!0}function r(){for(var o=0;o<C.length;o++)for(var t=0;t<L.cols;t++)if(void 0===C[o][t])return[o,t];return[C.length,0]}function e(o,t,i){if(i=n(i),1==t)return[1,1];for(var r=0;r<i.length;r++)if(s(i[r],o))return i[r];return[1,1]}function l(t,n,s){var r=o("<div></div>");r.css({height:"0","border-bottom-color":L.hLineColor,"border-bottom-width":i(L.hLineThickness),"border-bottom-style":"dotted",position:"absolute",width:i((s-n)*(x+T)+x),left:i(n*(x+T)),top:i(g*(z+T)+z+L.hSpacing)}),t.append(r)}function c(o,t){o.css({position:"absolute",display:"inline-block",width:i(t.cols*(x+T)-T),height:i(t.rows*(z+m)-m),left:i(t.pos[S]*(x+T)),top:i(t.pos[w]*(z+m))})}function a(o,t){return void 0!==C[o]&&C[o][t]!=C[o][t+1]}function h(o,t){return C[o][t]!=C[o+1][t]}function f(o,t){for(var i=o.data("rows"),n=o.data("cols"),s=o.data("pos"),r=t+1;r<s[w]+i;r++)for(var e=s[S];e<s[S]+n;e++)C[r][e]=void 0;o.data("rows",t-s[w]+1),c(o,o.data())}var d,u,v,p,g,b,w=0,S=1,L=o.extend({cols:3,hSpacing:10,vSpacing:10,hLineThickness:1,vLineThickness:1,hLineColor:"#ccc",vLineColor:"#ccc",selector:"div",sizes:[[1,1]],startsWith:[],aspectRatio:1},t),k=0,C=[],T=2*L.vSpacing+L.vLineThickness,m=2*L.hSpacing+L.hLineThickness,x=(this.width()-(L.cols-1)*T)/L.cols,z=x*L.aspectRatio,y=o(L.selector,this);if("fixed"==this.css("position"))return o.error("Grid objects can't have position: fixed on CSS."),this;if("static"==this.css("position")&&this.css("position","relative"),!y.length)return this;y.each(function(t){var i,n=r(),s=e(n,y.length-t,L.sizes),l=function(o){return o.join()};s=L.startsWith[t]||s;for(var a in L.classSizes){var h=L.classSizes[a].map(l),f=-1!=h.indexOf(l(s));o(this).hasClass(a)&&!f&&(s=e(n,y.length-t,L.classSizes[a]))}for(i={id:k++,pos:n,rows:s[0],cols:s[1]},t=n[w];t<n[w]+i.rows;t++)for(void 0===C[t]&&(C[t]=[]),p=n[S];p<n[S]+i.cols;p++)C[t][p]=i.id;c(o(this),i),o(this).data(i)});var j,M,R=o(y[y.length-1]),W=R.data("pos"),G=R.data("rows"),O=R.data("cols");if(void 0!==C[W[w]+G])for(v=0;v<L.cols;v++)C[W[w]+G][v]>=0&&(j=o(y[C[W[w]+G][v]]),f(j,W[w]+G-1));for(M=!0,v=W[S]+O;v<L.cols;v++)M&=C[W[w]][v]>=0;if(!M)for(v=W[S]+O;v<L.cols;v++)C[W[w]][v]>=0&&(j=o(y[C[W[w]][v]]),f(j,W[w]-1));for(M=!0,v=W[S]+O;v<L.cols;v++)M&=C[W[w]][v]>=0;if(!M){for(v=W[w];v<W[w]+G;v++)for(p=W[S]+O;p<L.cols;p++)C[v][p]=R.data("id");R.data("cols",L.cols-W[S]),c(R,R.data())}for(C.splice(W[w]+G,C.length-W[w]-G),b=0;b<L.cols-1;b++)for(d=null,u=null,g=0;g<C.length;){for(;a(g++,b);)null===d?(d=g-1,u=g-1):u=g-1;if(null!==d&&null!==u){var Q=o("<div></div>");Q.css({width:"0","border-left-width":i(L.vLineThickness),"border-left-style":"dotted","border-left-color":L.vLineColor,position:"absolute",height:i((u-d)*(z+m)+z),left:i(b*(x+T)+x+L.vSpacing),top:i(d*(z+m))}),this.append(Q),d=null,u=null}}for(g=0;g<C.length-1;g++)for(d=null,u=null,b=0;void 0!==C[g]&&b<L.cols;){for(;h(g,b++);)null===d?d=b-1:a(g,b-2)&&a(g+1,b-2)&&(l(this,d,u),d=b-1),u=b-1;null!==d&&null!==u&&(l(this,d,u),d=null,u=null)}return this.height(C.length*(z+m)),this}}(jQuery);