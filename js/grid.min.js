!function(t){"use strict";t.fn.grid=function(o){function i(t){return t+"px"}function n(t){for(var o,i,n=t.length;0!==n;)i=Math.floor(Math.random()*n),n-=1,o=t[n],t[n]=t[i],t[i]=o;return t}function s(t,o){if(o[S]+t[S]-1>=L.cols)return!1;for(var i=o[w];i<o[w]+t[w];i++)for(var n=o[S];n<o[S]+t[S];n++)if(void 0!==C[i]&&C[i][n]>=0)return!1;return!0}function r(){for(var t=0;t<C.length;t++)for(var o=0;o<L.cols;o++)if(void 0===C[t][o])return[t,o];return[C.length,0]}function e(t,o,i){if(i=n(i),1==o)return[1,1];for(var r=0;r<i.length;r++)if(s(i[r],t))return i[r];return[1,1]}function l(o,n,s){var r=t("<div></div>");r.css({height:"0","border-bottom-color":L.hLineColor,"border-bottom-width":i(L.hLineThickness),"border-bottom-style":"dotted",position:"absolute",width:i((s-n)*(x+T)+x),left:i(n*(x+T)),top:i(g*(z+T)+z+L.hSpacing)}),o.append(r)}function c(t,o){t.css({position:"absolute",display:"inline-block",width:i(o.cols*(x+T)-T),height:i(o.rows*(z+m)-m),left:i(o.pos[S]*(x+T)),top:i(o.pos[w]*(z+m))})}function a(t,o){return void 0!==C[t]&&C[t][o]!=C[t][o+1]}function h(t,o){return C[t][o]!=C[t+1][o]}function f(t,o){for(var i=t.data("rows"),n=t.data("cols"),s=t.data("pos"),r=o+1;r<s[w]+i;r++)for(var e=s[S];e<s[S]+n;e++)C[r][e]=void 0;t.data("rows",o-s[w]+1),c(t,t.data())}var d,u,v,p,g,b,w=0,S=1,L=t.extend({cols:3,hSpacing:10,vSpacing:10,hLineThickness:1,vLineThickness:1,hLineColor:"#ccc",vLineColor:"#ccc",selector:"div",sizes:[[1,1]],startsWith:[],aspectRatio:1},o),k=0,C=[],T=2*L.vSpacing+L.vLineThickness,m=2*L.hSpacing+L.hLineThickness,x=(this.width()-(L.cols-1)*T)/L.cols,z=x*L.aspectRatio,y=t(L.selector,this);if("fixed"==this.css("position"))return t.error("Grid objects can't have position: fixed on CSS."),this;if("static"==this.css("position")&&this.css("position","relative"),!y.length)return this;y.each(function(o){var i,n=r(),s=e(n,y.length-o,L.sizes),l=function(t){return t.join()};s=L.startsWith[o]||s;for(var a in L.classSizes){var h=L.classSizes[a].map(l),f=-1!=h.indexOf(l(s));t(this).hasClass(a)&&!f&&(s=e(n,y.length-o,L.classSizes[a]))}for(i={id:k++,pos:n,rows:s[0],cols:s[1]},o=n[w];o<n[w]+i.rows;o++)for(void 0===C[o]&&(C[o]=[]),p=n[S];p<n[S]+i.cols;p++)C[o][p]=i.id;c(t(this),i),t(this).data(i)});var j,M,R=t(y[y.length-1]),W=R.data("pos"),G=R.data("rows"),O=R.data("cols");if(void 0!==C[W[w]+G])for(v=0;v<W[S];v++)C[W[w]+G][v]>=0&&(j=t(y[C[W[w]+G][v]]),f(j,W[w]+G-1));for(M=!0,v=W[S]+O;v<L.cols;v++)M&=C[W[w]][v]>=0;if(!M)for(v=W[S]+O;v<L.cols;v++)C[W[w]][v]>=0&&(j=t(y[C[W[w]][v]]),f(j,W[w]-1));for(M=!0,v=W[S]+O;v<L.cols;v++)M&=C[W[w]][v]>=0;if(!M){for(v=W[w];v<W[w]+G;v++)for(p=W[S]+O;p<L.cols;p++)C[v][p]=R.data("id");R.data("cols",L.cols-W[S]),c(R,R.data())}for(C.splice(W[w]+G,C.length-W[w]-G),b=0;b<L.cols-1;b++)for(d=null,u=null,g=0;g<C.length;){for(;a(g++,b);)null===d?(d=g-1,u=g-1):u=g-1;if(null!==d&&null!==u){var Q=t("<div></div>");Q.css({width:"0","border-left-width":i(L.vLineThickness),"border-left-style":"dotted","border-left-color":L.vLineColor,position:"absolute",height:i((u-d)*(z+m)+z),left:i(b*(x+T)+x+L.vSpacing),top:i(d*(z+m))}),this.append(Q),d=null,u=null}}for(g=0;g<C.length-1;g++)for(d=null,u=null,b=0;void 0!==C[g]&&b<L.cols;){for(;h(g,b++);)null===d?d=b-1:a(g,b-2)&&a(g+1,b-2)&&(l(this,d,u),d=b-1),u=b-1;null!==d&&null!==u&&(l(this,d,u),d=null,u=null)}return this.height(C.length*(z+m)),this}}(jQuery);