!function(o){"use strict";o.fn.grid=function(t){function i(o){return o+"px"}function n(o){for(var t,i,n=o.length;0!==n;)i=Math.floor(Math.random()*n),n-=1,t=o[n],o[n]=o[i],o[i]=t;return o}function r(o,t){if(t[L]+o[L]-1>=S.cols)return!1;for(var i=t[w];i<t[w]+o[w];i++)for(var n=t[L];n<t[L]+o[L];n++)if(void 0!==T[i]&&T[i][n]>=0)return!1;return!0}function s(){for(var o=0;o<T.length;o++)for(var t=0;t<S.cols;t++)if(void 0===T[o][t])return[o,t];return[T.length,0]}function e(o,t){var i=n(S.sizes);if(1==t)return[1,1];for(var s=0;s<i.length;s++)if(r(i[s],o))return i[s];return[1,1]}function l(t,n,r){var s=o("<div></div>");s.css({height:"0","border-bottom-color":S.hLineColor,"border-bottom-width":i(S.hLineThickness),"border-bottom-style":"dotted",position:"absolute",width:i((r-n)*(x+C)+x),left:i(n*(x+C)),top:i(g*(x+C)+x+S.hSpacing)}),t.append(s)}function c(o,t){o.css({position:"absolute",display:"inline-block",width:i(t.cols*(x+C)-C),height:i(t.rows*(x+m)-m),left:i(t.pos[L]*(x+C)),top:i(t.pos[w]*(x+m))})}function a(o,t){return void 0!==T[o]&&T[o][t]!=T[o][t+1]}function f(o,t){return T[o][t]!=T[o+1][t]}function h(o,t){for(var i=o.data("rows"),n=o.data("cols"),r=o.data("pos"),s=t+1;s<r[w]+i;s++)for(var e=r[L];e<r[L]+n;e++)T[s][e]=void 0;o.data("rows",t-r[w]+1),c(o,o.data())}var d,u,v,p,g,b,w=0,L=1,S=o.extend({cols:3,hSpacing:10,vSpacing:10,hLineThickness:1,vLineThickness:1,hLineColor:"#ccc",vLineColor:"#ccc",selector:"div",sizes:[[1,1]]},t),k=0,T=[],C=2*S.vSpacing+S.vLineThickness,m=2*S.hSpacing+S.hLineThickness,x=(this.width()-(S.cols-1)*C)/S.cols,y=o(S.selector,this);if("fixed"==this.css("position"))return o.error("Grid objects can't have position: fixed on CSS."),this;"static"==this.css("position")&&this.css("position","relative"),y.each(function(t){var i=s(),n=e(i,y.length-t),r={id:k++,pos:i,rows:n[0],cols:n[1]};for(v=i[w];v<i[w]+r.rows;v++)for(void 0===T[v]&&(T[v]=[]),p=i[L];p<i[L]+r.cols;p++)T[v][p]=r.id;c(o(this),r),o(this).data(r)});var j,z,M=o(y[y.length-1]),G=M.data("pos"),Q=M.data("rows"),q=M.data("cols");if(void 0!==T[G[w]+Q])for(v=0;v<G[L];v++)T[G[w]+Q][v]>=0&&(j=o(y[T[G[w]+Q][v]]),h(j,G[w]+Q-1));for(z=!0,v=G[L]+q;v<S.cols;v++)z&=T[G[w]][v]>=0;if(!z)for(v=G[L]+q;v<S.cols;v++)T[G[w]][v]>=0&&(j=o(y[T[G[w]][v]]),h(j,G[w]-1));for(z=!0,v=G[L]+q;v<S.cols;v++)z&=T[G[w]][v]>=0;if(!z){for(v=G[w];v<G[w]+Q;v++)for(p=G[L]+q;p<S.cols;p++)T[v][p]=M.data("id");M.data("cols",S.cols-G[L]),c(M,M.data())}for(T.splice(G[w]+Q,T.length-G[w]-Q),b=0;b<S.cols-1;b++)for(d=null,u=null,g=0;g<T.length;){for(;a(g++,b);)null===d?(d=g-1,u=g-1):u=g-1;if(null!==d&&null!==u){var A=o("<div></div>");A.css({width:"0","border-left-width":i(S.vLineThickness),"border-left-style":"dotted","border-left-color":S.vLineColor,position:"absolute",height:i((u-d)*(x+m)+x),left:i(b*(x+C)+x+S.vSpacing),top:i(d*(x+m))}),this.append(A),d=null,u=null}}for(g=0;g<T.length-1;g++)for(d=null,u=null,b=0;void 0!==T[g]&&b<S.cols;){for(;f(g,b++);)null===d?d=b-1:a(g,b-2)&&a(g+1,b-2)&&(l(this,d,u),d=b-1),u=b-1;null!==d&&null!==u&&(l(this,d,u),d=null,u=null)}return this.height(T.length*(x+m)),this}}(jQuery);