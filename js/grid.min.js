(function(e){e.fn.grid=function(t){function n(e){return e+"px"}function r(e,t){if(t[o]+e["cols"]-1>=u["cols"])return false;for(var n=t[s];n<t[s]+e["rows"];n++)for(var r=t[o];r<t[o]+e["cols"];r++)if(f[n]!==undefined&&f[n][r])return false;return true}function i(t){var r=e("<div></div>");r.css({height:"0","border-bottom-color":u["hLineColor"],"border-bottom-width":n(u["hLineThickness"]),"border-bottom-style":"dotted",position:"absolute",width:n((y-g)*(d+h)+d),left:n(g*(d+h)),top:n(m*(d+h)+d+u["hSpacing"])});t.append(r)}var s=0,o=1;var u=e.extend({cols:3,hSpacing:10,vSpacing:10,hLineThickness:1,vLineThickness:1,hLineColor:"#ccc",vLineColor:"#ccc",selector:"div"},t);var a=0,f=new Array,l=new Array,c=new Array,h=u["vSpacing"]*2+u["vLineThickness"],p=u["hSpacing"]*2+u["hLineThickness"],d=(this.width()-(u["cols"]-1)*h)/u["cols"];if(this.css("position")=="fixed"){e.error("Grid objects can't have position: fixed on CSS.");return this}else if(this.css("position")=="static")this.css("position","relative");e(u["selector"],this).each(function(){var t=[0,0],i={id:++a,cols:e(this).data("cols"),rows:e(this).data("rows")};while(!r(i,t)){if(t[o]<=u["cols"])t[o]+=1;else{t[s]+=1;t[o]=0}}for(var v=t[s];v<t[s]+i["rows"];v++){if(f[v]===undefined)f[v]=new Array;for(var m=t[o];m<t[o]+i["cols"];m++)f[v][m]=a}if(t[s]>0){if(c[t[s]-1]===undefined)c[t[s]-1]=new Array;for(var v=t[o];v<t[o]+i["cols"];v++)c[t[s]-1][v]=true}if(t[o]>0){for(var v=t[s];v<t[s]+i["rows"];v++){if(l[v]===undefined)l[v]=new Array;l[v][t[o]-1]=true}}e(this).css({position:"absolute",display:"inline-block",width:n(i["cols"]*(d+h)-h),height:n(i["rows"]*(d+p)-p),left:n(t[o]*(d+h)),top:n(t[s]*(d+p))})});for(var v=0;v<u["cols"]-1;v++){var m=0,g=null,y=null;while(m<l.length){while(l[m]!==undefined&&l[m++][v]){if(g===null){g=m-1;y=m-1}else y=m-1}if(g!==null&&y!==null){var b=e("<div></div>");b.css({width:"0","border-left-width":n(u["vLineThickness"]),"border-left-style":"dotted","border-left-color":u["vLineColor"],position:"absolute",height:n((y-g)*(d+p)+d),left:n(v*(d+h)+d+u["vSpacing"]),top:n(g*(d+p))});this.append(b);g=null;y=null}}}for(var m=0;m<c.length;m++){var v=0,g=null,y=null;while(c[m]!==undefined&&v<u["cols"]){while(c[m][v++]){if(g===null)g=v-1;else if(l[m]!==undefined&&l[m+1]!==undefined){if(l[m][v-2]&&l[m+1][v-2]){i(this);g=v-1}}y=v-1}if(g!==null&&y!==null){i(this);g=null;y=null}}}this.height(f.length*(d+p));return this}})(jQuery)
