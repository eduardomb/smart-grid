!function(o){"use strict";o.fn.grid=function(t){function i(o){return o+"px"}function n(o){for(var t,i,n=o.length;0!==n;)i=Math.floor(Math.random()*n),n-=1,t=o[n],o[n]=o[i],o[i]=t;return o}function r(o,t){if(t[S]+o[S]-1>=L.cols)return!1;for(var i=t[w];i<t[w]+o[w];i++)for(var n=t[S];n<t[S]+o[S];n++)if(void 0!==C[i]&&C[i][n]>=0)return!1;return!0}function s(){for(var o=0;o<C.length;o++)for(var t=0;t<L.cols;t++)if(void 0===C[o][t])return[o,t];return[C.length,0]}function e(o,t,i){if(i=n(i),1==t)return[1,1];for(var s=0;s<i.length;s++)if(r(i[s],o))return i[s];return[1,1]}function l(t,n,r){var s=o("<div></div>");s.css({height:"0","border-bottom-color":L.hLineColor,"border-bottom-width":i(L.hLineThickness),"border-bottom-style":"dotted",position:"absolute",width:i((r-n)*(x+T)+x),left:i(n*(x+T)),top:i(g*(x+T)+x+L.hSpacing)}),t.append(s)}function c(o,t){o.css({position:"absolute",display:"inline-block",width:i(t.cols*(x+T)-T),height:i(t.rows*(x+m)-m),left:i(t.pos[S]*(x+T)),top:i(t.pos[w]*(x+m))})}function a(o,t){return void 0!==C[o]&&C[o][t]!=C[o][t+1]}function h(o,t){return C[o][t]!=C[o+1][t]}function f(o,t){for(var i=o.data("rows"),n=o.data("cols"),r=o.data("pos"),s=t+1;s<r[w]+i;s++)for(var e=r[S];e<r[S]+n;e++)C[s][e]=void 0;o.data("rows",t-r[w]+1),c(o,o.data())}var d,u,v,p,g,b,w=0,S=1,L=o.extend({cols:3,hSpacing:10,vSpacing:10,hLineThickness:1,vLineThickness:1,hLineColor:"#ccc",vLineColor:"#ccc",selector:"div",sizes:[[1,1]],startsWith:[]},t),k=0,C=[],T=2*L.vSpacing+L.vLineThickness,m=2*L.hSpacing+L.hLineThickness,x=(this.width()-(L.cols-1)*T)/L.cols,z=o(L.selector,this);if("fixed"==this.css("position"))return o.error("Grid objects can't have position: fixed on CSS."),this;if("static"==this.css("position")&&this.css("position","relative"),!z.length)return this;z.each(function(t){var i,n=s(),r=e(n,z.length-t,L.sizes),l=function(o){return o.join()};r=L.startsWith[t]||r;for(var a in L.classSizes){var h=L.classSizes[a].map(l),f=-1!=h.indexOf(l(r));o(this).hasClass(a)&&!f&&(r=e(n,z.length-t,L.classSizes[a]))}for(i={id:k++,pos:n,rows:r[0],cols:r[1]},t=n[w];t<n[w]+i.rows;t++)for(void 0===C[t]&&(C[t]=[]),p=n[S];p<n[S]+i.cols;p++)C[t][p]=i.id;c(o(this),i),o(this).data(i)});var y,j,M=o(z[z.length-1]),W=M.data("pos"),G=M.data("rows"),O=M.data("cols");if(void 0!==C[W[w]+G])for(v=0;v<W[S];v++)C[W[w]+G][v]>=0&&(y=o(z[C[W[w]+G][v]]),f(y,W[w]+G-1));for(j=!0,v=W[S]+O;v<L.cols;v++)j&=C[W[w]][v]>=0;if(!j)for(v=W[S]+O;v<L.cols;v++)C[W[w]][v]>=0&&(y=o(z[C[W[w]][v]]),f(y,W[w]-1));for(j=!0,v=W[S]+O;v<L.cols;v++)j&=C[W[w]][v]>=0;if(!j){for(v=W[w];v<W[w]+G;v++)for(p=W[S]+O;p<L.cols;p++)C[v][p]=M.data("id");M.data("cols",L.cols-W[S]),c(M,M.data())}for(C.splice(W[w]+G,C.length-W[w]-G),b=0;b<L.cols-1;b++)for(d=null,u=null,g=0;g<C.length;){for(;a(g++,b);)null===d?(d=g-1,u=g-1):u=g-1;if(null!==d&&null!==u){var Q=o("<div></div>");Q.css({width:"0","border-left-width":i(L.vLineThickness),"border-left-style":"dotted","border-left-color":L.vLineColor,position:"absolute",height:i((u-d)*(x+m)+x),left:i(b*(x+T)+x+L.vSpacing),top:i(d*(x+m))}),this.append(Q),d=null,u=null}}for(g=0;g<C.length-1;g++)for(d=null,u=null,b=0;void 0!==C[g]&&b<L.cols;){for(;h(g,b++);)null===d?d=b-1:a(g,b-2)&&a(g+1,b-2)&&(l(this,d,u),d=b-1),u=b-1;null!==d&&null!==u&&(l(this,d,u),d=null,u=null)}return this.height(C.length*(x+m)),this}}(jQuery);